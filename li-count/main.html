<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>计算器</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
    </head>
    <body>

        <!-- html -->
        <div class="container">
            <div class="jumbotron">
                <div style="padding: 30px 100px 10px;">
                    <p>使用说明：</p>
                    <p>1.根据实验结果输入测试值</p>
                    <p>2.点击“计算”按钮 公式：F = am</p>
                    <p>3.表格刷新并构建</p>
                    <form class="bs-example bs-example-form" role="form">
                        <div class="row">
                            <div class="">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-addon">Emp</span>
                                    <input type="text" class="form-control">
                                    <span class="input-group-addon">.00</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <p class="text-center">
                    <a class="btn btn-primary btn-lg" role="button" id="computeBtn" onclick='computeTable()'>
                        计算
                    </a>
                    
                    <a class="btn btn-primary btn-lg" role="button" onclick='tableToExcel()'>
                        归档
                    </a>
                </p>
            </div>
            <div id="progressBarId" style="display: none;">
                <div class="progress progress-striped active">
                    <div class="progress-bar progress-bar-info" role="progressbar"
                         aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                         style="width: 0%;" id="progressId">
                        <!-- <span class="sr-only">60% 完成</span> -->
                    </div>
                </div>
            </div>
            <div id="tableDivId" >
                <table class="table table-striped table-bordered" id="dataTable">
                    <!-- <caption>--表格--</caption> -->
                    <thead>
                        <tr>
                            <th></th>
                            <th style="background-color: chocolate;text-align: center;" colspan="7">实际测定值</th>
                            <th style="background-color: yellow;text-align: center;" colspan="7">计算值</th>
                        </tr>
                        <tr>
                            <th></th>
                            <th style="background-color: darkgoldenrod; text-align: center;" colspan="7">风干样基础</th>
                            <th style="background-color: cornflowerblue; text-align: center;" colspan="7">DM基础</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>样品名称</td>
                            <td>105℃</td>
                            <td>NDF</td>
                            <td>ADF</td>
                            <td>CP</td>
                            <td>Ash</td>
                            <td>EE</td>
                            <td>ADL</td>
                            <td>DM</td>
                            <td>NDF</td>
                            <td>ADF</td>
                            <td>CP</td>
                            <td>Ash</td>
                            <td>EE</td>
                            <td>ADL</td>
                        </tr>
                        <tr>
                            <td rowspan="2" style="vertical-align: middle;">黑曲霉发酵复合酶</td>
                            <td>91.67</td>
                            <td>42.40</td>
                            <td>28.93</td>
                            <td>19.02</td>
                            <td>8.96</td>
                            <td>2.98</td>
                            <td>11.72</td>
                            <td>91.67</td>
                            <td>46.25</td>
                            <td>31.56</td>
                            <td>20.75</td>
                            <td>9.77</td>
                            <td>3.25</td>
                            <td>12.78</td>
                        </tr>
                        <tr>
                            <td>91.63</td>
                            <td>41.69</td>
                            <td>22.38</td>
                            <td>19.03</td>
                            <td>8.89</td>
                            <td>3.05</td>
                            <td>7.89</td>
                            <td>91.63</td>
                            <td>45.50</td>
                            <td>24.42</td>
                            <td>20.77</td>
                            <td>9.70</td>
                            <td>3.33</td>
                            <td>8.62</td>
                        </tr>
                        <tr>
                            <td rowspan="2" style="vertical-align: middle;">米曲霉发酵复合酶</td>
                            <td>92.58</td>
                            <td>41.70</td>
                            <td>28.73</td>
                            <td>19.73</td>
                            <td>6.34</td>
                            <td>3.65</td>
                            <td>8.46</td>
                            <td>92.58</td>
                            <td>45.04</td>
                            <td>31.03</td>
                            <td>21.31</td>
                            <td>6.85</td>
                            <td>3.95</td>
                            <td>9.13</td>
                        </tr>
                        <tr>
                            <td>92.47</td>
                            <td>42.79</td>
                            <td>31.75</td>
                            <td>19.74</td>
                            <td>6.43</td>
                            <td>3.66</td>
                            <td>10.62</td>
                            <td>92.47</td>
                            <td>46.28</td>
                            <td>34.34</td>
                            <td>21.34</td>
                            <td>6.95</td>
                            <td>3.96</td>
                            <td>11.48</td>
                        </tr>
                        <tr>
                            <td rowspan="2" style="vertical-align: middle;">米曲霉孢子粉</td>
                            <td>89.19</td>
                            <td>5.75</td>
                            <td>2.06</td>
                            <td>37.78</td>
                            <td>5.07</td>
                            <td>1.38</td>
                            <td></td>
                            <td>89.19</td>
                            <td>6.45</td>
                            <td>2.31</td>
                            <td>42.36</td>
                            <td>5.69</td>
                            <td>1.55</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>89.13</td>
                            <td>18.97</td>
                            <td>1.42</td>
                            <td>37.32</td>
                            <td>4.99</td>
                            <td>1.18</td>
                            <td></td>

                            <td>89.13</td>
                            <td>21.28</td>
                            <td>1.60</td>
                            <td>41.87</td>
                            <td>5.60</td>
                            <td>1.33</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- js -->
        <script> 
            const computeTable = () => {
                // step 1 disabled
                $("#progressId").attr("style","width:0%")
                $("#progressBarId").show();
                $("#tableDivId").hide();
                $("#computeBtn").addClass("disabled");
                // step 2 compute build
                
                // step 3 show 
                $("#progressId").attr("style","width:100%")
                var ovt = setTimeout(function(){
                    $("#progressBarId").hide();
                    $("#tableDivId").show();
                    $("#computeBtn").removeClass("disabled");
                }, 800);

            };

            const tableToExcel = () => {
                // 所有行
                let tableStr = $("#dataTable tr")
                let result = ""
                tableStr.each(function(){
                    result+="<tr>"+$(this).html()+"</tr>";
                })
                // Worksheet名
                const worksheet = 'Sheet1'
                const uri = 'data:application/vnd.ms-excel;base64,';
                // 下载的表格模板数据
                const template = `<html xmlns:o="urn:schemas-microsoft-com:office:office"
                xmlns:x="urn:schemas-microsoft-com:office:excel"
                xmlns="http://www.w3.org/TR/REC-html40">
                <head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
                <x:Name>${worksheet}</x:Name>
                <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>
                </x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
                </head><body><table>${result}</table></body></html>`;
                // 下载模板
                window.location.href = uri + base64(template);
            };
        
            // 输出base64编码
            const base64 = s => window.btoa(unescape(encodeURIComponent(s)));
        </script>
    </body>
</html>